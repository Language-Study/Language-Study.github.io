<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
    <script src="password.js" defer></script>
</head>

<body>
    <div class="container">
        <h1>Reset Your Password</h1>
        <div id="resetPasswordMsg" class="text-sm mb-4"></div>
        <form id="resetPasswordForm">
            <input type="password" id="newPassword" placeholder="Enter new password" required>
            <button type="submit">Reset Password</button>
        </form>
    </div>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB8B5Saw8kArUOIL_m5NHFWDQwplR8HF_c",
            authDomain: "language-study-tracker.firebaseapp.com",
            projectId: "language-study-tracker",
            storageBucket: "language-study-tracker.appspot.com",
            messagingSenderId: "47054764584",
            appId: "1:47054764584:web:7c0b6597bc42aaf961131d"
        };
        firebase.initializeApp(firebaseConfig);

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const oobCode = urlParams.get('oobCode');

            if (!oobCode) {
                document.getElementById('resetPasswordMsg').textContent = 'Invalid or missing reset code.';
                return;
            }

            const resetPasswordForm = document.getElementById('resetPasswordForm');
            resetPasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const newPassword = document.getElementById('newPassword').value;
                const resetPasswordMsg = document.getElementById('resetPasswordMsg');

                try {
                    await firebase.auth().confirmPasswordReset(oobCode, newPassword);
                    resetPasswordMsg.textContent = 'Password has been reset successfully!';
                    resetPasswordMsg.classList.add('text-green-500');
                } catch (error) {
                    console.error('Error resetting password:', error);
                    resetPasswordMsg.textContent = `Failed to reset password: ${error.message}`;
                    resetPasswordMsg.classList.add('text-red-500');
                }
            });
        });
    </script>
</body>

</html>